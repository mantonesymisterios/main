<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mantones y Misterios - Podcast</title>

  <!-- FAVICONS / PWA BASICS -->
  <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png" />
  <link rel="icon" href="img/favicon.ico" />
  <meta name="theme-color" content="#503a65" />

  <link rel="stylesheet" href="styles.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <!-- NAVBAR -->
  <header class="navbar">
    <div class="nav-container">
      <a href="#inicio" class="logo">
        <div class="logo-icon">
          <img src="img/Logo.png" alt="Logo Mantones y Misterios">
        </div>
        <span>Mantones y Misterios</span>
      </a>

      <nav class="nav-links">
        <a href="#inicio">Inicio</a>
        <a href="#player">Escuchar</a>
        <a href="#podcast">Podcast</a>
        <a href="#blog">Cr√≥nicas</a>
        <a href="#archivo">Archivo</a>
      </nav>

      <a href="#yapa" class="btn btn-donate">üçΩÔ∏è Inv√≠tanos un ceviche</a>
    </div>
  </header>

  <!-- MEN√ö M√ìVIL -->
  <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Abrir men√∫ de navegaci√≥n">
    ‚ò∞
  </button>

  <!-- HERO -->
  <section class="hero" id="inicio">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <span class="hero-tagline">üéß Narrado por Sintia Alvarado</span>

      <h1 class="hero-title">
        Entre <br />
        <span>Mantones y Misterios</span>
      </h1>

      <p class="hero-meta">
        Relatos del Per√∫ oculto ¬∑ Nuevo episodio cada mes
      </p>

      <div class="hero-actions">
        <!-- Bot√≥n que baja al reproductor de la p√°gina -->
        <a href="#player" class="btn btn-play">
          <span class="play-icon">‚ñ∂</span>
        </a>
        <span class="hero-actions-text">Comienza el relato aqu√≠</span>

        <!-- Bot√≥n directo a Spotify -->
        <a
          href="https://open.spotify.com/show/0pkfh76wm3tz1cGTwlLYNL"
          class="btn btn-hero-spotify"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="currentColor"
            aria-hidden="true"
            style="margin-right: 0.5rem; flex-shrink: 0;"
          >
            <path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.28 17.35a.89.89 0 0 1-1.23.3c-3.36-2.06-7.59-2.53-12.57-1.38a.89.89 0 0 1-.41-1.74c5.45-1.28 10.17-.74 13.9 1.61.42.26.55.82.31 1.21zm1.33-3.22a1.1 1.1 0 0 1-1.52.37c-3.85-2.37-9.71-3.06-14.25-1.65a1.1 1.1 0 0 1-.64-2.11c5.19-1.58 11.6-.8 15.96 1.9.51.32.67 1 .35 1.49zm.16-3.39C14.5 8.02 9.45 7.83 5.24 9.12a1.31 1.31 0 1 1-.75-2.51c4.79-1.44 10.57-1.21 15.43 1.85a1.31 1.31 0 0 1-1.35 2.27z" />
          </svg>
          Escuchar en Spotify
        </a>
      </div>
    </div>
  </section>

  <!-- SECCI√ìN REPRODUCTOR PRINCIPAL -->
  <section class="spotify-section" id="player">
    <div class="container spotify-container">
      <div class="spotify-text">
        <h2>Historias que susurran desde el Per√∫</h2>
        <p>
          Desde el coraz√≥n de Per√∫, narramos historias que el tiempo no pudo borrar: leyendas,
          sucesos y memorias que a√∫n buscan ser escuchadas.
        </p>
      </div>

      <div class="spotify-player" id="audioPlayerContainer">
        <div style="
          background: linear-gradient(135deg, #fbf1e6 0%, #f5e6d3 100%);
          border-radius: 12px;
          padding: 2rem;
          color: #6b5b95;
        ">
          <div style="display: flex; gap: 1.5rem; align-items: center; flex-wrap: wrap;">
            <img
              id="currentEpisodeImage"
              src="img/Mantonesymisterios.jpeg"
              alt="√öltimo episodio de Mantones y Misterios"
              style="
                width: 120px;
                height: 120px;
                border-radius: 8px;
                object-fit: cover;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
              "
            >
            <div style="flex: 1; min-width: 200px;">
              <p style="
                margin: 0 0 0.5rem 0;
                opacity: 0.8;
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 1px;
              ">
                √öltimo episodio
              </p>
              <h3
                id="currentEpisodeTitle"
                style="margin: 0 0 1rem 0; font-size: 1.3rem; line-height: 1.3;"
              >
                Cargando episodio...
              </h3>

              <audio
                id="mainAudioPlayer"
                controls
                style="width: 100%; margin-top: 1rem;"
              >
                <source src="" type="audio/mpeg">
                Tu navegador no soporta el elemento de audio.
              </audio>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- LISTADO DE EPISODIOS (RSS) -->
  <main class="main-content" id="podcast">
    <section class="episodes-section">
      <div class="container">
        <header class="episodes-header">
          <h2>Cr√≥nicas del Per√∫ oculto</h2>
          <p>
            Aqu√≠ se re√∫nen todos los relatos publicados hasta ahora. Historias nacidas en Lima
            y en los rincones m√°s olvidados de Per√∫.
          </p>
        </header>

        <div id="episodesContainer" class="episodes-container">
          <p class="loading">Cargando episodios.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- PAGINACI√ìN -->
  <section class="pagination-section">
    <div class="container pagination-container">
      <button class="pagination-btn pagination-prev" id="btnPrev">
        ‚Äπ Relatos recientes
      </button>
      <button class="pagination-btn pagination-next" id="btnNext">
        Relatos antiguos ‚Ä∫
      </button>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container footer-content">
      <p>Mantones y Misterios ¬∑ Podcast desde Per√∫</p>

      <div class="podcast-platforms">
        <!-- Spotify -->
        <a
          href="https://open.spotify.com/show/0pkfh76wm3tz1cGTwlLYNL"
          class="platform-link"
          title="Escucha en Spotify"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm5.28 17.35a.89.89 0 0 1-1.23.3c-3.36-2.06-7.59-2.53-12.57-1.38a.89.89 0 0 1-.41-1.74c5.45-1.28 10.17-.74 13.9 1.61.42.26.55.82.31 1.21zm1.33-3.22a1.1 1.1 0 0 1-1.52.37c-3.85-2.37-9.71-3.06-14.25-1.65a1.1 1.1 0 0 1-.64-2.11c5.19-1.58 11.6-.8 15.96 1.9.51.32.67 1 .35 1.49zm.16-3.39C14.5 8.02 9.45 7.83 5.24 9.12a1.31 1.31 0 1 1-.75-2.51c4.79-1.44 10.57-1.21 15.43 1.85a1.31 1.31 0 0 1-1.35 2.27z" />
          </svg>
        </a>

        <!-- Apple Podcasts -->
        <a
          href="https://podcasts.apple.com/us/podcast/entre-mantones-y-misterios/id1859290149"
          class="platform-link"
          title="Escucha en Apple Podcasts"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 3.25a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5zM9.5 12c0-1.378 1.122-2.5 2.5-2.5s2.5 1.122 2.5 2.5c0 1.027-.617 1.909-1.5 2.285V18a1 1 0 1 1-2 0v-3.715A2.494 2.494 0 0 1 9.5 12zm-2 0c0-2.481 1.815-4.543 4.25-4.95a.75.75 0 0 1 .5 1.414C10.827 8.78 9.5 10.248 9.5 12a.75.75 0 0 1-1.5 0zm9.5 0a.75.75 0 0 1-1.5 0c0-1.752-1.327-3.22-3.25-3.536a.75.75 0 1 1 .5-1.414C15.685 7.457 17 9.519 17 12z" />
          </svg>
        </a>

        <!-- RSS (Anchor) -->
        <a
          href="https://anchor.fm/s/10c6409d0/podcast/rss"
          class="platform-link"
          title="Ver feed RSS"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M4 4a2 2 0 0 0-2 2v2a1 1 0 0 0 1 1c6.627 0 12 5.373 12 12a1 1 0 0 0 1 1h2a2 2 0 0 0 2-2C20 11.82 12.18 4 3 4H2v2a2 2 0 0 0 2 2h0z"/>
            <path d="M4 12a2 2 0 0 0-2 2v2a1 1 0 0 0 1 1c2.761 0 5 2.239 5 5a1 1 0 0 0 1 1h2a2 2 0 0 0 2-2c0-4.971-4.029-9-9-9H4z"/>
            <circle cx="5" cy="19" r="2" />
          </svg>
        </a>

        <!-- Castbox -->
        <a
          href="https://castbox.fm/channel/id6902942?country=es"
          class="platform-link"
          title="Escucha en Castbox"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <rect x="4" y="4" width="16" height="16" rx="4" />
            <path d="M10 9v6l4-3z" />
          </svg>
        </a>

        <!-- YouTube / Podcasts -->
        <a
          href="https://www.youtube.com/@Mantonesymisterios/podcasts"
          class="platform-link"
          title="Escucha en YouTube Podcasts"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M23.5 6.2a2.85 2.85 0 0 0-2-2C19.8 3.75 12 3.75 12 3.75s-7.8 0-9.5.45a2.85 2.85 0 0 0-2 2C0 7.9 0 12 0 12s0 4.1.5 5.8a2.85 2.85 0 0 0 2 2C4.2 20.25 12 20.25 12 20.25s7.8 0 9.5-.45a2.85 2.85 0 0 0 2-2C24 16.1 24 12 24 12s0-4.1-.5-5.8zM9.75 15.5v-7l6 3.5-6 3.5z" />
          </svg>
        </a>

        <!-- Instagram -->
        <a
          href="https://www.instagram.com/mantonesymisterios/"
          class="platform-link"
          title="S√≠guenos en Instagram"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <rect x="3" y="3" width="18" height="18" rx="5" ry="5" />
            <circle cx="12" cy="12" r="4" />
            <circle cx="17" cy="7" r="1.2" />
          </svg>
        </a>

        <!-- TikTok -->
        <a
          href="https://www.tiktok.com/@mantonesymisterios"
          class="platform-link"
          title="S√≠guenos en TikTok"
          target="_blank"
          rel="noopener noreferrer"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M16.5 3.5c.5 1.4 1.6 2.5 3 3v3.1c-1.2-.1-2.3-.5-3.4-1.1v5.9c0 3.5-2.3 5.9-5.6 5.9-3 0-5.4-2.3-5.4-5.3 0-3 2.4-5.3 5.4-5.3.4 0 .8 0 1.1.1v3.1c-.3-.1-.6-.1-.9-.1-1.3 0-2.4 1-2.4 2.3 0 1.3 1 2.3 2.4 2.3 1.4 0 2.4-1 2.4-2.6V3.5h3z" />
          </svg>
        </a>
      </div>

      <div class="footer-links">
        <a href="#inicio">Volver arriba</a>
        <span>¬∑</span>
        <a href="#">Pol√≠tica de Privacidad</a>
        <span>¬∑</span>
        <a href="#">T√©rminos y Condiciones de Uso</a>
      </div>

      <div class="footer-copyright">
        <span>Dise√±o: &copy; Alberto Peralta</span>
      </div>
    </div>
  </footer>

  <!-- JS: RSS2JSON + PAGINACI√ìN -->
  <script>
    // ===== CONFIGURACI√ìN =====
    const PODCAST_RSS = "https://anchor.fm/s/10c6409d0/podcast/rss";
    const RSS_API = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(PODCAST_RSS)}`;
    const EPISODES_PER_PAGE = 4;
    const DEBUG = true;

    // ===== ELEMENTOS DEL DOM =====
    const episodesContainer = document.getElementById("episodesContainer");
    const btnNext = document.getElementById("btnNext");
    const btnPrev = document.getElementById("btnPrev");
    const mobileMenuToggle = document.getElementById("mobileMenuToggle");
    const navLinks = document.querySelector(".nav-links");

    // ===== ESTADO =====
    let allEpisodes = [];
    let visibleCount = EPISODES_PER_PAGE;

    // ===== CARGAR FEED =====
    async function loadEpisodesFromRSS() {
      try {
        episodesContainer.innerHTML = '<p class="loading">Cargando episodios.</p>';

        if (DEBUG) console.log("üîÑ Cargando feed desde RSS2JSON.");

        const response = await fetch(RSS_API);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();

        if (DEBUG) {
          console.log("üì° Respuesta recibida:", data);
          console.log("üì¶ Episodios encontrados:", data.items?.length || 0);
        }

        if (data.status !== "ok") {
          throw new Error(data.message || "Error en la respuesta de RSS2JSON");
        }

        if (!data.items || data.items.length === 0) {
          episodesContainer.innerHTML = "<p>No se encontraron episodios en el feed.</p>";
          return;
        }

        allEpisodes = data.items.map((item, index) => {
          const description = item.description || "";
          const audioUrl = item.enclosure?.link || item.link || null;
          const imageUrl =
            item.thumbnail ||
            item.enclosure?.thumbnail ||
            "https://images.pexels.com/photos/6898859/pexels-photo-6898859.jpeg?auto=compress&cs=tinysrgb&w=1600";

          return {
            title: item.title || "Episodio sin t√≠tulo",
            description,
            pubDate: item.pubDate || "",
            audioUrl,
            imageUrl,
            author: item.author || "",
            categories: item.categories || [],
            index,
          };
        });

        // Actualizar el reproductor superior con el episodio m√°s reciente
        if (allEpisodes.length > 0) {
          // Suponemos que el feed viene ordenado de m√°s nuevo a m√°s antiguo
          playEpisodeInMainPlayer(allEpisodes[0]);
        }

        visibleCount = Math.min(EPISODES_PER_PAGE, allEpisodes.length);
        renderEpisodes();
      } catch (error) {
        console.error("‚ùå Error cargando feed:", error);
        episodesContainer.innerHTML = `
          <div class="error" style="text-align: center; padding: 2rem; color: #e74c3c;">
            <p style="font-size: 1.2rem; margin-bottom: 1rem;">‚ö†Ô∏è No se pudo cargar el feed</p>
            <p style="font-size: 0.9rem; opacity: 0.8;">
              ${error.message}<br><br>
              Verifica que el feed RSS sea v√°lido y est√© accesible.
            </p>
            <button onclick="location.reload()"
                    style="margin-top: 1rem; padding: 0.5rem 1rem; cursor: pointer;
                           background: #3498db; color: white; border: none;
                           border-radius: 4px; font-size: 0.9rem;">
              üîÑ Reintentar
            </button>
          </div>
        `;
        btnNext.disabled = true;
        btnPrev.disabled = true;
      }
    }

    // ===== RENDERIZAR EPISODIOS =====
    function renderEpisodes() {
      episodesContainer.innerHTML = "";

      const visibleEpisodes = allEpisodes.slice(0, visibleCount);

      visibleEpisodes.forEach((ep) => {
        const dateText = ep.pubDate
          ? new Date(ep.pubDate).toLocaleDateString("es-ES", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
          : "";

        const shortDesc =
          ep.description.length > 260
            ? ep.description.slice(0, 260) + "‚Ä¶"
            : ep.description;

        const article = document.createElement("article");
        article.className = "episode-card";

        article.innerHTML = `
          <div class="episode-image">
            <img src="${ep.imageUrl}" alt="${ep.title}" loading="lazy">
            <button class="play-button-card"
                    ${ep.audioUrl ? "" : "disabled"}
                    title="${ep.audioUrl ? "Reproducir episodio" : "Audio no disponible"}">
              ‚ñ∂
            </button>
          </div>
          <div class="episode-info">
            <span class="episode-category">Podcast</span>
            <h2 class="episode-title">${ep.title}</h2>
            <p class="episode-meta">
              ${dateText ? dateText : ""}
            </p>
            <p class="episode-description">${shortDesc}</p>
            <div class="episode-inline-player"></div>
          </div>
        `;

        const playButton = article.querySelector(".play-button-card");
        const inlinePlayerContainer = article.querySelector(".episode-inline-player");

        if (ep.audioUrl && playButton && inlinePlayerContainer) {
          playButton.addEventListener("click", (e) => {
            e.preventDefault();

            // Limpiar cualquier reproductor previo en esta tarjeta
            inlinePlayerContainer.innerHTML = "";

            const audio = document.createElement("audio");
            audio.controls = true;
            audio.src = ep.audioUrl;
            audio.autoplay = true;

            inlinePlayerContainer.appendChild(audio);
          });
        }

        episodesContainer.appendChild(article);
      });

      updatePaginationButtons();
    }

    // ===== PAGINACI√ìN =====
    function updatePaginationButtons() {
      btnPrev.disabled = visibleCount <= EPISODES_PER_PAGE;
      btnNext.disabled = visibleCount >= allEpisodes.length;
    }

    btnNext.addEventListener("click", () => {
      if (visibleCount < allEpisodes.length) {
        visibleCount = Math.min(
          visibleCount + EPISODES_PER_PAGE,
          allEpisodes.length,
        );
        renderEpisodes();
      }
    });

    btnPrev.addEventListener("click", () => {
      if (visibleCount > EPISODES_PER_PAGE) {
        visibleCount = Math.max(
          visibleCount - EPISODES_PER_PAGE,
          EPISODES_PER_PAGE,
        );
        renderEpisodes();
      }
    });

    // ===== MEN√ö M√ìVIL =====
    if (mobileMenuToggle && navLinks) {
      mobileMenuToggle.addEventListener("click", () => {
        navLinks.classList.toggle("nav-links--open");
      });

      navLinks.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", () => {
          navLinks.classList.remove("nav-links--open");
        });
      });
    }

    // ===== SCROLL SUAVE NAVBAR (CON COMPENSACI√ìN) =====
    const navbar = document.querySelector(".navbar");
    const NAVBAR_OFFSET = navbar ? navbar.offsetHeight : 0;

    document.querySelectorAll('a[href^="#"]').forEach((link) => {
      link.addEventListener("click", (event) => {
        const href = link.getAttribute("href");
        if (!href || href === "#") return;

        const targetId = href.substring(1);
        const targetEl = document.getElementById(targetId);
        if (!targetEl) return;

        event.preventDefault();
        const rect = targetEl.getBoundingClientRect();
        const scrollTop = window.scrollY || window.pageYOffset;
        const offset = rect.top + scrollTop - NAVBAR_OFFSET;

        window.scrollTo({
          top: offset,
          behavior: "smooth",
        });

        if (navLinks) navLinks.classList.remove("nav-links--open");
      });
    });

    // ===== REPRODUCIR EN REPRODUCTOR PRINCIPAL =====
    function playEpisodeInMainPlayer(episode) {
      const mainAudioPlayer = document.getElementById("mainAudioPlayer");
      const currentEpisodeImage = document.getElementById("currentEpisodeImage");
      const currentEpisodeTitle = document.getElementById("currentEpisodeTitle");

      if (!mainAudioPlayer || !currentEpisodeImage || !currentEpisodeTitle || !episode) return;

      currentEpisodeImage.src = episode.imageUrl;
      currentEpisodeImage.alt = episode.title;
      currentEpisodeTitle.textContent = episode.title;

      const newSource = document.createElement("source");
      newSource.src = episode.audioUrl || "";
      newSource.type = "audio/mpeg";

      mainAudioPlayer.innerHTML = "";
      mainAudioPlayer.appendChild(newSource);
      mainAudioPlayer.load();
    }

    // ===== INICIALIZAR =====
    loadEpisodesFromRSS();
  </script>

</body>
</html>
